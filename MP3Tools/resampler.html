<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<title>MP3 Resampler</title>
</head>
<body>
<h1>MP3 Resampler</h1>
<input type="file" id="audioFile" accept=".mp3"><br><br>
<label>Target Sample Rate (Hz): </label>
<input type="number" id="sampleRate" value="44100"><br><br>
<button id="resampleBtn">Resample</button>
<p id="status"></p>

<script type="module">
import FFmpeg from "https://esm.run/@ffmpeg/ffmpeg@0.12.6";
const { createFFmpeg, fetchFile } = FFmpeg;

const ffmpeg = createFFmpeg({ log: true });

document.getElementById('resampleBtn').addEventListener('click', async () => {
  const fileInput = document.getElementById('audioFile');
  const rateInput = document.getElementById('sampleRate');
  const status = document.getElementById('status');

  if (!fileInput.files.length) {
    alert('Please select an MP3 file.');
    return;
  }

  const sampleRate = parseInt(rateInput.value);
  if (!sampleRate || sampleRate <= 0) {
    alert('Please enter a valid sample rate.');
    return;
  }

  const file = fileInput.files[0];
  status.textContent = 'Loading FFmpeg (this may take a moment)...';
  if (!ffmpeg.isLoaded()) await ffmpeg.load();

  status.textContent = 'Resampling...';
  ffmpeg.FS('writeFile', 'input.mp3', await fetchFile(file));
  await ffmpeg.run('-i', 'input.mp3', '-ar', sampleRate.toString(), 'output.mp3');

  const data = ffmpeg.FS('readFile', 'output.mp3');
  const url = URL.createObjectURL(new Blob([data.buffer], { type: 'audio/mp3' }));

  const link = document.createElement('a');
  link.href = url;
  link.download = `resampled_${sampleRate}Hz.mp3`;
  link.click();

  status.textContent = 'Done!';
});
</script>

</body>
</html>
